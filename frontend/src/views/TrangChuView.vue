<template>
  <CustomerWithNav>
    <ThemVaoGioHang
      :visible="isThemVaoGioHangModalVisible"
      :sanPham="sanPhamDuocChon"
      @close="dongThemVaoGioHangModal"
      @add="handleThemVaoGioHang"
    />
    <BannerSlider />

    <ListSanPham
      tieuDe="S·∫£n ph·∫©m m·ªõi"
      :dsSanPham="dsSanPhamMoi"
      linkXemThem="/san-pham-moi"
      @themVaoGioHang="hienThiThemVaoGioHangModal"
    />

    <ListSanPham
      tieuDe="B√°n ch·∫°y nh·∫•t"
      :dsSanPham="dsBanChay"
      linkXemThem="/ban-chay-nhat"
      @themVaoGioHang="hienThiThemVaoGioHangModal"
    />
  </CustomerWithNav>
</template>

<script setup lang="ts">
import { ref } from "vue";
import CustomerWithNav from "@/components/layouts/CustomerWithNav.vue";
import BannerSlider from "@/components/trangchu/BannerSlider.vue";
import { useToast } from "@/composables/useToast";
import type { SanPham } from "@/types/SanPham.ts";
import ThemVaoGioHang from "@/components/base/ThemVaoGioHang.vue";
import ListSanPham from "@/components/base/ListSanPham.vue";

const { showToast } = useToast();

// Mock data s·∫£n ph·∫©m m·ªõi
const dsSanPhamMoi: SanPham[] = [
  {
    maSanPham: 1,
    tenSanPham: "Gi√†y cao g√≥t",
    nhan: "M·ªõi",
    donGia: 200000,
    anhMinhHoa: ["https://picsum.photos/300?random=1"],
    donVi: "ƒê√¥i",
    nhaSanXuat: "Township",
    danhMucCha: "Qu·∫ßn √°o",
    danhMucCon: "Gi√†y d√©p",
  },
  {
    maSanPham: 2,
    tenSanPham: "√Åo s∆° mi nam",
    nhan: "M·ªõi",
    donGia: 350000,
    anhMinhHoa: ["https://picsum.photos/300?random=2"],
    donVi: "C√°i",
    nhaSanXuat: "Urban Outfit",
    danhMucCha: "Qu·∫ßn √°o",
    danhMucCon: "√Åo s∆° mi",
  },
  {
    maSanPham: 5,
    tenSanPham: "√Åo s∆° mi nam",
    nhan: "M·ªõi",
    donGia: 350000,
    anhMinhHoa: ["https://picsum.photos/300?random=2"],
    donVi: "C√°i",
    nhaSanXuat: "Urban Outfit",
    danhMucCha: "Qu·∫ßn √°o",
    danhMucCon: "√Åo s∆° mi",
  },
  {
    maSanPham: 6,
    tenSanPham: "√Åo s∆° mi nam",
    nhan: "M·ªõi",
    donGia: 350000,
    anhMinhHoa: ["https://picsum.photos/300?random=2"],
    donVi: "C√°i",
    nhaSanXuat: "Urban Outfit",
    danhMucCha: "Qu·∫ßn √°o",
    danhMucCon: "√Åo s∆° mi",
  },
  {
    maSanPham: 7,
    tenSanPham: "√Åo s∆° mi nam",
    nhan: "M·ªõi",
    donGia: 350000,
    anhMinhHoa: ["https://picsum.photos/300?random=2"],
    donVi: "C√°i",
    nhaSanXuat: "Urban Outfit",
    danhMucCha: "Qu·∫ßn √°o",
    danhMucCon: "√Åo s∆° mi",
  },
];

// Mock data b√°n ch·∫°y
const dsBanChay = [
  {
    maSanPham: 3,
    tenSanPham: "Balo th·ªùi trang",
    nhan: "B√°n ch·∫°y",
    donGia: 400000,
    anhMinhHoa: ["https://picsum.photos/300?random=3"],
    donVi: "C√°i",
    nhaSanXuat: "GearBag",
    danhMucCha: "Kh√°c",
    danhMucCon: "Balo v√† t√∫i x√°ch",
  },
  {
    maSanPham: 4,
    tenSanPham: "Qu·∫ßn jeans n·ªØ",
    donGia: 290000,
    anhMinhHoa: ["https://picsum.photos/300?random=4"],
    donVi: "C√°i",
    nhaSanXuat: "DenimX",
    danhMucCha: "Qu·∫ßn √°o",
    danhMucCon: "Qu·∫ßn jeans",
  },
];

const isThemVaoGioHangModalVisible = ref(false);
const sanPhamDuocChon = ref<SanPham | null>(null);

const hienThiThemVaoGioHangModal = (product: SanPham) => {
  sanPhamDuocChon.value = product;
  isThemVaoGioHangModalVisible.value = true;
};

const dongThemVaoGioHangModal = () => {
  isThemVaoGioHangModalVisible.value = false;
  sanPhamDuocChon.value = null;
};

const handleThemVaoGioHang = (payload: {
  sanPham: SanPham;
  soLuong: number;
}) => {
  console.log(
    "üõí Th√™m s·∫£n ph·∫©m v√†o gi·ªè:",
    payload.sanPham,
    "S·ªë l∆∞·ª£ng:",
    payload.soLuong
  );
  dongThemVaoGioHangModal();
  showToast({
    thongBao: `ƒê√£ th√™m "${payload.soLuong} ${payload.sanPham.tenSanPham}" v√†o gi·ªè h√†ng!`,
    loai: "thanhCong",
  });
};
</script>
